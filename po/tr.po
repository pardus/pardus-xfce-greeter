import re
import datetime

# New strings (potential candidates to add)
new_strings = [
    "System Information",
    "Operating System:",
    "XFCE Version:",
    "Kernel Version:",
    "Hostname:",
    "GTK Theme:",
    "Icon Theme:",
    "N/A"
]

# actual_po_content is from the read_files call (file_contents[0] for this turn)
actual_po_content = file_contents[0]

# Determine which of the new_strings are not already in tr.po
existing_msgids_po = set(re.findall(r'msgid "([^"]*(?:""[^"]*)*)"', actual_po_content))
po_new_entries = []

for s in new_strings:
    s_escaped = s.replace('"', '\\"')
    if s_escaped not in existing_msgids_po:
        po_new_entries.append(f'\n\n#. Automatically added by AI Agent\nmsgid "{s_escaped}"\nmsgstr "{s_escaped}"')

final_updated_po_content = actual_po_content
if po_new_entries:
    if actual_po_content and not actual_po_content.endswith('\n'):
        final_updated_po_content += '\n'
    final_updated_po_content += "".join(po_new_entries) + "\n"

# Update POT-Creation-Date and PO-Revision-Date in tr.po
now = datetime.datetime.now(datetime.timezone.utc).astimezone()
new_formatted_date = now.strftime("%Y-%m-%d %H:%M%z")
if len(new_formatted_date) > 3 and new_formatted_date[-3] != ':': # Ensure HH:MM format for timezone offset
    new_formatted_date = new_formatted_date[:-2] + ":" + new_formatted_date[-2:]

final_updated_po_content = re.sub(
    r'"POT-Creation-Date: [^"\\]*(?:\\.[^"\\]*)*"',
    f'"POT-Creation-Date: {new_formatted_date}\\n"',
    final_updated_po_content,
    count=1
)
final_updated_po_content = re.sub(
    r'"PO-Revision-Date: [^"\\]*(?:\\.[^"\\]*)*"',
    f'"PO-Revision-Date: {new_formatted_date}\\n"',
    final_updated_po_content,
    count=1
)

print(final_updated_po_content)
